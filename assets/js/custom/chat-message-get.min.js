function refresh(){setTimeout(function(){asyncChatMessageChecker(),refresh()},3e3)}function chatGetMessages(){var a="../assets/res/joytown_api?method=chatGetMessages";$.ajax({type:"GET",url:a,dataType:"json",encode:!0}).done(function(a){$(a).each(function(b,c){var d=$("#message-body");c.success===!0?(d.empty(),d.jqoteapp("#message_template",a.data)):(d.empty(),d.append("<li class='list-group-item'><span>No messages.<br><br>Start a conversation</span></li>"))})}).fail(function(){var a=$("#message-body");a.empty(),a.append("<li class='list-group-item'><span>Messages Could not be retrieved</span><span style='font-size: small'><br>Oops! Network Failure!</span></li>")})}function notifyMe(){if("Notification"in window)if("granted"===Notification.permission){new Notification("New Message",{icon:"http://sajoytownsecondary.org/img/logo.jpg"})}else"denied"!==Notification.permission&&Notification.requestPermission(function(a){if("granted"===a){new Notification("New Message",{icon:"http://sajoytownsecondary.org/img/logo.jpg"})}});else;}function asyncChatMessageChecker(){var a="../assets/res/joytown_api?act=asyncChatMessageChecker";$.ajax({type:"GET",url:a,dataType:"json",encode:!0}).done(function(a){$(a.d).each(function(a,b){b.n===!0&&(chatGetMessages(),$.playSound("https://sajoytownsecondary.org/js/triopoint/notification/gets-in-the-way"),notifyMe())})}).fail(function(){})}function chatGetMessagesAfterSend(){var a="../assets/res/joytown_api?method=chatGetMessages";$.ajax({type:"GET",url:a,dataType:"json",encode:!0}).done(function(a){$(a).each(function(b,c){if(c.success===!0){var d=$("#message-body");$("#chatNewMessageArea").focus(),d.empty(),d.jqoteapp("#message_template",a.data)}else $("#chatNewMessageArea").focus(),$("#message-body").append("<li class='list-group-item'><span>No messages.<br><br>Start a conversation</span></li>")})}).fail(function(){$("#chatNewMessageArea").focus(),$("#message-body").append("<li class='list-group-item'><span>Messages Could not be retrieved</span><span style='font-size: small'><br>Oops! Network Failure!</span></li>")})}function getUser(a){$("#getUserInfoModal").modal("toggle"),$("#chat_staff_email_get").empty(),$("#chat_staff_email_get_two").empty(),$("#chat_profile_avatar_get").attr("src",""),$("#chat_phone_get").empty(),$("#chat_department_get").empty();var b=$("#chat_profile_name_get");b.empty(),b.html("Loading...");var c="../assets/res/joytown_api?method=getPassedStaffDetails&staff_email="+a;$.ajax({type:"GET",url:c,dataType:"json",encode:!0}).done(function(b){$(b.data).each(function(c,d){d.success===!0?($("#chat_staff_email_get").html(a),$("#chat_staff_email_get_two").html(a),$("#chat_profile_avatar_get").attr("src","../assets/res/uploads/"+b.data.prof_pic),$("#chat_profile_name_get").html(b.data.salutation+" "+b.data.name),$("#chat_department_get").html(b.data.department),$("#chat_phone_get").html(b.data.phone)):$("#chat_profile_name_get").html("Failed to retrieve user info")})}).fail(function(){$("#chat_profile_name_get").html("Failed to retrieve user info <br><span style='font-size: small'>Oops! Network Failure!</span>")})}$(document).ready(function(){$("#chatNewMessageArea").focus(),$("html, body").animate({scrollTop:1e10}),chatGetMessages()}),$(document).ready(function(){setTimeout(function(){asyncChatMessageChecker(),refresh()},3e3)}),$(document).keypress(function(a){if(13==a.which){var b=$("textarea[name=chatNewMessage]").val();""!==b&&0!=b.length&&b?$("#chatAddMessageForm").submit():$("#chatNewMessageArea").focus()}});